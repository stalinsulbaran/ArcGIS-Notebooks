<html lang="en">
<head>
  <meta charset="utf-8">
  <title>CesiumJS en ArcGIS</title>
  <!-- Incluir archivos CesiumJS JavaScript y CSS -->
  <script src="https://cesium.com/downloads/cesiumjs/releases/1.107/Build/Cesium/Cesium.js"></script>
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.107/Build/Cesium/Widgets/widgets.css" rel="stylesheet">

  <!-- require librerías ArcGIS REST JS desde https://unpkg.com -->
  <script src="https://unpkg.com/@esri/arcgis-rest-request@4.0.0/dist/bundled/request.umd.js"></script>
  <script src="https://unpkg.com/@esri/arcgis-rest-feature-service@4.0.0/dist/bundled/feature-service.umd.js"></script>
  <style>

  html, body, #cesiumContainer {
    width:100%;
    height:100%;
    padding:0px;
    margin:0px;
  }
  </style>
</head>
<body>
  <div id="cesiumContainer"></div>
  <script>
    // Añadir la API Key de ArcGIS
    const apiKey = "AAPKb8c2910020444d0ea7ece665de5ba5b1FxdVBB72nYpOV7JIznI3Rlw_lWpz-fF4WmEYl0t6sCfsonJgq5_y7vUgh2CBhElR";

    Cesium.ArcGisMapService.defaultAccessToken = apiKey;
    // Añadir el Access Token de Cesium
    const authentication = arcgisRest.ApiKeyManager.fromKey(apiKey);

    const cesiumAccessToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJjYTBjYjhiZS02MjY4LTRhYzctOGQ3Yi03NzE1ZjIyOGE2MTIiLCJpZCI6NTE0NzIsImlhdCI6MTYxODE2MTc3Mn0.LagRf7fOO4Q0ky62S1PxPSQ25lemnaGeH4oxGP81uYM";
    Cesium.Ion.defaultAccessToken = cesiumAccessToken;
    // Añadir el mapa base de ArcGIS
    const arcGisImagery = Cesium.ArcGisMapServerImageryProvider.fromBasemapType(Cesium.ArcGisBaseMapType.SATELLITE, {
      enablePickFeatures:false
    });
    // Añadir el visor de Cesium
    const viewer = new Cesium.Viewer("cesiumContainer", {

        baseLayer: Cesium.ImageryLayer.fromProviderAsync(arcGisImagery),

        terrain: Cesium.Terrain.fromWorldTerrain(),
        timeline: false,
        animation: false,
        geocoder:false

    });
    // Establecer la vista y su altura
    viewer.camera.setView({
    
      destination : Cesium.Cartesian3.fromDegrees(-70.5630588428333, -33.4099953821995, 1500), // Ubicación central de la vista (Longitud, Latitud) y la altura
      orientation : {
        heading : Cesium.Math.toRadians(0.0), // Definir el heading de la cámara
        pitch : Cesium.Math.toRadians(-70.0), // Definir el pitch de la cámara
      }

    });
    // Añadir el Feature Layer como  GeoJSON
    const pointLayerName = "Sede_ESRI_Chile";
    const pointLayerURL = "https://services2.arcgis.com/YnekfD3lwdpJ9Xy8/arcgis/rest/services/"+pointLayerName+"/FeatureServer/0";

    arcgisRest.queryFeatures({
        url: pointLayerURL,
        authentication,
        f:"geojson"
    }).then((response) => {

        const data = Cesium.GeoJsonDataSource.load(response,{
            clampToGround:true
        })
        viewer.dataSources.add(data);

    });

  </script>
</body>
</html>